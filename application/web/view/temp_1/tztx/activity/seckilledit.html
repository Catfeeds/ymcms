{include file="$temp_header" /}
<!--主体内容 start-->
<style type="text/css">
    .display{
        display: none;
}
</style>
<div id="main">
	{include file="$temp_aside" /}
    <div id="content">
    	<div class="title">
          <div class="box">
        	<div class="lef">{$title}</div>
            <div class="rig">
            	<a href="{:url('web/tztx.activity/seckill')}"><img src="__IMAGE__/ico_white/circle_left.png" />返回</a>
            </div>
          </div>
        </div>
        <div class="section">
            <div class="tit">
                <img src="__IMAGE__/ico_black/circle_plus.png" />{$title}
            </div>        
    		<!--内容 start-->
            <div class="info">         
              <form action="" id="fileups" method="post" enctype="multipart/form-data">
              <iframe id="upload_target" name="upload_target" src="#" style="display:none;width:0;height:0;border:0px solid #fff;"></iframe>
				<ul>             
                	<li>
                    	<div class="lef"><span class="nam">所属分类<span class="red">*</span></span></div>
                        <div class="rig">
                            <select name="category" id="category">
                                <option value="" disabled selected >请选择分类</option>
                                {notempty name="category"}
                                {volist name="category" id="vo"}
                                <option value="{$vo.id}" {notempty name='content'}{if condition='$vo.id == $content.cate_id '}selected{/if}{/notempty}>{$vo.name}</option>
                                {/volist}
                                {/notempty}
                            </select>
                        </div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">秒杀商品<span class="red">*</span></span></div>
                        <div class="rig">
                            <select name="seckill" id="seckill">
                                <option value="" disabled selected >请选择商品</option>
                            </select>
                        </div>
                    </li>
                    <!--
                	<li>
                    	<div class="lef"><span class="nam">类型</span></div>
                        <div class="rig">
                        	<label>参数名：<input type="text" name="type[option][]" value="{notempty name='content'}{$content.type}{/notempty}" /></label>
                            <label>值1：<input type="text" name="type[value][]" value="{notempty name='content'}{$content.type}{/notempty}" /></label>
                            <label>值2：<input type="text" name="type[value][]" value="{notempty name='content'}{$content.type}{/notempty}" /></label>
                        </div> 
					</li>
                    -->
                    <li>
                        <div class="lef"><span class="nam">出售价<span class="red">*</span></span></div>
                        <div class="rig"><input type="number" name="price" value="{notempty name='content'}{$content.price}{/notempty}" step="0.01" /></div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">秒杀价<span class="red">*</span></span></div>
                        <div class="rig"><input type="number" name="price_seckill" value="{notempty name='content'}{$content.price_seckill}{/notempty}" step="0.01" />
                        <p>由于第三方支付的限制，价格不能为0，最少0.01</p>
                        </div>
                    </li>
                    <!-- <li>
                        <div class="lef"><span class="nam">秒杀数量<span class="red">*</span></span></div>
                        <div class="rig"><input type="number" name="price_seckill_num" value="{notempty name='content'}{$content.price_seckill_num}{/notempty}" /></div>
                    </li> -->
                    <li>
                        <div class="lef"><span class="nam">秒杀库存<span class="red">*</span></span></div>
                        <div class="rig"><input type="number" name="total" value="{notempty name='content'}{$content.total}{/notempty}" /></div>
                    </li>
                	<!-- <li>
                        <div class="lef"><span class="nam">规格</span></div>
                        <div class="rig">
                            <div class="switchesss"><img src="" imga="__IMAGE__/switches_a.png" imgb="__IMAGE__/switches_b.png" spec="{notempty name='content'}{$content.spec}{else/}1{/notempty}" /><span>启用规格</span></div>
                            <input id="spec" type="hidden" name="spec" value="{notempty name='content'}{$content.spec}{else/}1{/notempty}" />
                        </div>
                    </li>
                    <li class="dis">
                        <div class="lef"><span class="nam">秒杀规格</span></div>
                        <div class="rig">
                            <div class="addval">+ 添加规格</div>
                            {notempty name='spec'}
                            {volist name="spec" id="vo"}
                            <div class="valline">
                                <label>规格名：<input style="width: 10%;" type="text" class="nam" name="" value="{$vo.option}" /></label>
                                <label class="display">销量值：<input style="width: 10%;" type="number" class="xl" name="" value="{$vo.xl}" /></label>
                                <label class="display">价格值：<input style="width: 10%;" type="number" class="money" name="" value="{$vo.money}" /></label>
                                <label>秒杀价：<input style="width: 10%;" type="number" class="seckill" name="" value="{$vo.seckill}" /></label>
                                <label>秒杀数量：<input style="width: 10%;" type="number" class="seckill_num" name="" value="{$vo.seckill_num}" /></label>
                                <label>秒杀销量：<input style="width: 10%;" type="number" class="seckill_xl" name="" value="{$vo.seckill_xl}" /></label>
                                <label>库存值：<input style="width: 10%;" type="number" class="stock" name="" value="{$vo.stock}" /></label>
                                <span class="delval">×</span>
                            </div>
                            {/volist}
                            {else/}
                            <div class="valline">
                                <label>规格名：<input style="width: 10%;" type="text" class="nam" name="" value="" /></label>
                                <label class="display">销量值：<input style="width: 10%;" type="number" class="xl" name="" value="" /></label>
                                <label class="display">价格值：<input style="width: 10%;" type="number" class="money" name="" value="" /></label>
                                <label>秒杀价：<input style="width: 10%;" type="number" class="seckill" name="" value="" /></label>
                                <label>秒杀数量：<input style="width: 10%;" type="number" class="seckill_num" name="" value="" /></label>
                                <label>秒杀销量：<input style="width: 10%;" type="number" class="seckill_xl" name="" value="" /></label>
                                <label>库存值：<input style="width: 10%;" type="number" class="stock" name="" value="" /></label>
                                <span class="delval">×</span>
                            </div>
                            {/notempty}
                        </div>
                    </li> -->
                    <li>
                        <div class="lef"><span class="nam">开放时间<span class="red">*</span></span></div>
                        <div class="rig">
                            <div>
                                <label><input name="open_time[]" type="checkbox" value="0"> <span>00:00~00:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="1"> <span>01:00~01:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="2"> <span>02:00~02:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="3"> <span>03:00~03:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="4"> <span>04:00~04:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="5"> <span>05:00~05:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="6"> <span>06:00~06:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="7"> <span>07:00~07:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="8"> <span>08:00~08:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="9"> <span>09:00~09:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="10"> <span>10:00~10:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="11"> <span>11:00~11:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="12"> <span>12:00~12:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="13"> <span>13:00~13:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="14"> <span>14:00~14:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="15"> <span>15:00~15:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="16"> <span>16:00~16:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="17"> <span>17:00~17:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="18"> <span>18:00~18:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="19"> <span>19:00~19:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="20"> <span>20:00~20:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="21"> <span>21:00~21:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="22"> <span>22:00~22:59</span></label> 
                                <label><input name="open_time[]" type="checkbox" value="23"> <span>23:00~23:59</span></label>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">限购数量<span class="red">*</span></span></div>
                        <div class="rig">
                            <input type="number" name="max_number" value="{notempty name='content'}{$content.max_number}{/notempty}" />
                            <p>每个订单限制购买数量，填写0表示不限购，默认不限购</p>
                        </div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">限购单数<span class="red">*</span></span></div>
                        <div class="rig">
                            <input type="number" name="single" value="{notempty name='content'}{$content.single}{/notempty}" />
                            <p>本次秒杀限制下单数量，填写0表示不限购，默认不限购</p>
                        </div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">开放日期<span class="red">*</span></span></div>
                        <div class="rig">
                            <input type="text" name="open_date" id="test6" value="{notempty name='content'}{$content.date}{/notempty}" />
                            <p>范围内所有天数,最多添加时长为1个月,多余的自动过滤</p>
                        </div>
                    </li>
                    <li>
                    	<div class="lef">&nbsp;</div>
                        <div class="rig"><button type="button" id="upmit">{$submit.name}</button></div>
                    </li>

                </ul>
                <script type="text/javascript" src="__JS__/laydate.js"></script>
                <script type="text/javascript">
                    //日期范围
                    laydate.render({
                      elem: '#test6'
                      ,range: '~'
                    });
                </script>
                <script>
				/*实时整理上传参数*/
				function fileval(randclass){
					var filejson_li = randclass.parents('li');
					var filejson_arr = new Array();
					filejson_li.find('.files').each(function(i){
                        filejson_arr[i] = $(this).find('.filejson').attr('filename');
                    });
					filejson_li.find('.fileval').val(filejson_arr);					
				}
				$('.fileval').each(function(){
                   fileval($(this)); 
                });
                /*异步上传的回调方法*/
                function stopUpload(filename,oldname,randclass){
					var randclass = $('.'+randclass);
					var filesrc = ""+filename;
					randclass.find('img').addClass('filejson').attr('src',filesrc).attr('filename',filename);
					randclass.find('b').text(oldname);
					fileval(randclass);
                }						
				$(document).ready(function(e){
					/*选择图片*/
					function filechange(){	
						/*选取事件*/
						$('.filesinp').change(function(){
							/*增加异步识别类*/
							var mydate = new Date();
							var randclass = 'ajax'+mydate.getTime()+parseInt(999990*Math.random());
							$(this).parents('label').addClass(randclass);
							/*提交表单*/
							var inpname = $(this).attr('name');
							$("#fileups").attr("action","{:url('System/fileups')}?inpname="+inpname+"&randclass="+randclass);
							$("#fileups").attr("target","upload_target");
							$("#fileups").submit();
						})
						/*删除*/
						$(".del").click(function(){
							var delfileval = $(this).parents('li').find('.fileval');
							$(this).parent().remove();
							fileval(delfileval);
						})				
					}
					filechange();
					/*上传添加*/
					$(".fileadd").click(function(){
						var filesinp_num = $('.filesinp').length + 1;
						$(this).parents('.imgbox').before('<div class="imgbox"><label class="files"><input class="filesinp" type="file" name="fileadd_'+filesinp_num+'" value="" /><span><img src="__IMAGE__/ico_white/magnifying_glass.png" /><b>选择文件</b></span></label><span class="del"><img src="__IMAGE__/ico_white/bin.png" /></span></div>');
						filechange();
					})					
                    /*状态*/
					function changestatus(){
                        /*规格*/
                        var spec = $(".switchesss img").attr('spec');
                        if(spec == 1){
                            $(".switchesss img").attr('src',$(".switchesss img").attr('imgb'));
                            $(".switchesss img").parent().find('span').text('启用规格');
                            $('.dis').show();
                        }else{
                            $(".switchesss img").attr('src',$(".switchesss img").attr('imga'));
                            $(".switchesss img").parent().find('span').text('禁用规格');
                            $('.dis').hide();
                        }
					}
					changestatus();
                    /*规格*/
                    $(".switchesss img").click(function(){
                        if($(this).attr('spec') == 1){
                            $(this).attr('spec',0);
                            $(this).attr('src',$(this).attr('imga'));
                            $(this).parent().find('span').text('禁用规格');
                            $("#spec").val(0);
                        }else{
                            $(this).attr('spec',1);
                            $(this).attr('src',$(this).attr('imgb'));
                            $(this).parent().find('span').text('启用规格');
                            $("#spec").val(1);                        
                        }
                        changestatus();
                    })
					/*提交*/
					$("#upmit").click(function(){
						$("#fileups").attr("action","{$submit.url}");
						$("#fileups").attr("target","");
						$("#fileups").submit();						
					})
					/*g规格传参*/
                    function valvalue(){
                        $(".valline").each(function(i){
                            /*单值*/
                            $(this).find('.nam').attr('name','val['+i+'][option]');
                            $(this).find('.xl').attr('name','val['+i+'][xl]');
                            $(this).find('.money').attr('name','val['+i+'][money]');
                            $(this).find('.seckill').attr('name','val['+i+'][seckill]');
                            $(this).find('.seckill_num').attr('name','val['+i+'][seckill_num]');
                            $(this).find('.seckill_xl').attr('name','val['+i+'][seckill_xl]');
                            $(this).find('.stock').attr('name','val['+i+'][stock]');
                            /*多值*
                            $(this).find('.con').each(function(s){
                                $(this).attr('name','val['+i+'][value]['+s+']');
                            })  
                            */                      
                        });
                    }
                    valvalue();                 
                    /*添加参数*/
                    $(".addval").click(function(){
                        var addcon = '<div class="valline">                                <label>规格名：<input style="width: 10%;" type="text" class="nam" name="" value="" /></label>                                <label class="display">销量值：<input style="width: 10%;" type="number" class="xl" name="" value="" /></label>                                <label class="display">价格值：<input style="width: 10%;" type="number" class="money" name="" value="" /></label>                                <label>秒杀价：<input style="width: 10%;" type="number" class="seckill" name="" value="" /></label>                                <label>秒杀数量：<input style="width: 10%;" type="number" class="seckill_num" name="" value="" /></label>    <label>秒杀销量：<input style="width: 10%;" type="number" class="seckill_xl" name="" value="" /></label>                 <label>库存值：<input style="width: 10%;" type="number" class="stock" name="" value="" /></label>                                <span class="delval">×</span>                            </div>';
                        $(this).after(addcon);
                        valvalue();
                    })
                    /*删除参数 新加元素动态绑定*/
                    $('.rig').on('click','.delval',function(){
                        $(this).parent().remove();
                        valvalue();
                    })
                    /*秒杀商品*/
                    $('#category').change(function () {
                        $('#seckill').html('<option value="" disabled selected >请选择商品</option>');
                        var cid = $('#category').val();
                        $.ajax({
                            url:"{:url('web/common/getgoods')}",
                            data:"id="+cid,
                            type:"GET",
                            success:function (e) {
                                if (e == "") {
                                    alert('当前分类下,没有商品');
                                } else {
                                    $('#seckill').html(e);
                                }
                            }
                        })
                    });
                    /*获取商品信息*/
                    $('#seckill').change(function () {
                        /*商品ID*/
                        var gid = $('#seckill').val();
                        $("input[name='price']").val('');/*出售价格*/
                        // $("input[name='price_seckill']").val('');/*秒杀价格*/
                        // $("input[name='price_seckill_num']").val('');//秒杀数量
                        $("input[name='total']").val('');//秒杀库存
                        /*请求商品数据*/
                        $.ajax({
                            url:"{:url('web/common/getgoodsedit')}",
                            data:"id="+gid,
                            type:"GET",
                            dataType:'json',
                            success:function (e) {
                                $("input[name='price']").val(e.price);//出售价格
                                // $("input[name='price_seckill']").val(e.price_seckill);//秒杀价格
                                // $("input[name='price_seckill_num']").val(e.price_seckill_num);//秒杀数量
                                $("input[name='total']").val(e.total);//秒杀库存
                            }
                        })
                    });
                });
				</script>
              <form>  
            </div>
            <!--内容 end-->
        </div>        
    </div>
</div>
<!--主体内容 end-->
{include file="$temp_footer" /}