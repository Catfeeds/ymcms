{include file="$temp_header" /}
<!--主体内容 start-->
<style type="text/css">
.mag label{
    margin: 0 10px 0 10px;
}
</style>
<div id="main">
	{include file="$temp_aside" /}
    <div id="content">
    	<div class="title">
          <div class="box">
        	<div class="lef">{$title}</div>
            <div class="rig">
            	<a href="{:url('web/tztx.activity/coupon')}"><img src="__IMAGE__/ico_white/circle_left.png" />返回</a>
            </div>
          </div>
        </div>
        <div class="section">
            <div class="tit">
                <img src="__IMAGE__/ico_black/circle_plus.png" />{$title}
            </div>
    		<!--内容 start-->
            <div class="info">         
              <form action="" id="fileups" method="post" enctype="multipart/form-data">
              <iframe id="upload_target" name="upload_target" src="#" style="display:none;width:0;height:0;border:0px solid #fff;"></iframe>
				<ul>
                	<li>
                    	<div class="lef"><span class="nam">名称<span class="red">*</span></span></div>
                        <div class="rig"><input type="text" name="title" value="{notempty name='content'}{$content.title}{/notempty}" placeholder="请输入名称.." required /></div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">类型<span class="red">*</span></span></div>
                        <div class="rig mag" id="numbertype">
                            <label><input  type="radio" name="type" value="1" checked >满减券</label>
                            <label><input  type="radio" name="type" value="2" 
                                {notempty name='content'}
                                {if condition="$content.type eq 2 "}
                                    checked
                                {/if}
                                {/notempty}
                            >通用卷</label>
                            <label><input  type="radio" name="type" value="3" 
                                {notempty name='content'}
                                {if condition="$content.type eq 3 "}
                                    checked
                                {/if}
                                {/notempty}
                            >首单卷</label>
                        </div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">最低消费金额（元）<span class="red">*</span></span></div>
                        <div class="rig">
                            <input type="number" name="minimum" value="{notempty name='content'}{$content.minimum}{/notempty}" placeholder="请输入最低消费金额.." required />
                        </div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">优惠金额（元）<span class="red">*</span></span></div>
                        <div class="rig">
                            <input type="number" name="favourable" value="{notempty name='content'}{$content.favourable}{/notempty}" placeholder="请输入优惠金额.." required />
                        </div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">优惠券有效类型<span class="red">*</span></span></div>
                        <div class="rig mag" id="daytype">
                            <label><input  type="radio" name="favourtype" value="1" checked >领取后N天内有效</label>
                            <label><input  type="radio" name="favourtype" value="2" 
                            {notempty name='content'}
                            {if condition="$content.favourtype eq 2 "}
                                checked
                            {/if}
                            {/notempty}
                            >时间段</label>
                        </div>
                    </li>
                    <li class="day">
                        <div class="lef"><span class="nam">有效天数<span class="red">*</span></span></div>
                        <div class="rig">
                            <input type="number" name="day" value="{notempty name='content'}{$content.day}{/notempty}" placeholder="请输入有效天数.." required />
                        </div>
                    </li>
                    <li class="daytime">
                        <div class="lef"><span class="nam">有效时间<span class="red">*</span></span></div>
                        <div class="rig">
                            <input type="text" name="daytime" id="daytime" value="{notempty name='content.daystart'}{$content.daystart}{/notempty}" placeholder="请输入有效时间范围.." required />
                        </div>
                    </li>
                    <li>
                        <div class="lef"><span class="nam">加入领卷中心<span class="red">*</span></span></div>
                        <div class="rig mag">
                            <label><input  type="radio" name="centrality" value="1" checked >加入</label>
                            <label><input  type="radio" name="centrality" value="2" 
                                {notempty name='content'}
                                {if condition="$content.centrality eq 2 "}
                                    checked
                                {/if}
                                {/notempty}
                            >不加入</label>
                        </div>
                    </li>
<!--                     <li>
                        <div class="lef"><span class="nam">指定商品类别优惠</span></div>
                        <div class="rig">
                            <select name="group_id">
                                <option value="0" selected >不指定请忽略</option>
                                {volist name="group" id="vo"}
                                {notempty name='content'}
                                <option value="{$vo.id}" 
                                {if condition='$content.group_id == $vo.id '} selected {/if}> 
                                {$vo.name}
                                </option>
                                {/notempty}
                                {/volist}
                            </select>
                        </div>
                    </li> -->
                    <li>
                        <div class="lef"><span class="nam">排序<span class="red">*</span></span></div>
                        <div class="rig">
                            <input type="number" name="order" value="{notempty name='content'}{$content.order}{else/}100{/notempty}" required />
                            <p class="red">注：排序按升序排列</p>
                        </div>
                    </li>
                    <li>
                    	<div class="lef"><span class="nam">状态<span class="red">*</span></span></div>
                        <div class="rig">
                        	<div class="switches"><img src="" imga="__IMAGE__/switches_a.png" imgb="__IMAGE__/switches_b.png" status="{notempty name='content'}{$content.status}{else/}1{/notempty}" /><span>启用</span></div>
                            <input id="status" type="hidden" name="status" value="{notempty name='content'}{$content.status}{else/}1{/notempty}" />
                        </div>
                    </li>
                    <li>
                    	<div class="lef">&nbsp;</div>
                        <div class="rig"><button type="button" id="upmit">{$submit.name}</button></div>
                    </li>
                </ul>
                <script>
				/*实时整理上传参数*/
				function fileval(randclass){
					var filejson_li = randclass.parents('li');
					var filejson_arr = new Array();
					filejson_li.find('.files').each(function(i){
                        filejson_arr[i] = $(this).find('.filejson').attr('filename');
                    });
					filejson_li.find('.fileval').val(filejson_arr);					
				}
				$('.fileval').each(function(){
                   fileval($(this)); 
                });
                /*异步上传的回调方法*/
                function stopUpload(filename,oldname,randclass){
					var randclass = $('.'+randclass);
					var filesrc = ''+filename;
					randclass.find('img').addClass('filejson').attr('src',filesrc).attr('filename',filename);
					randclass.find('b').text(oldname);
					fileval(randclass);
                }
				$(document).ready(function(e){
					/*选择图片*/
					function filechange(){	
						/*选取事件*/
						$('.filesinp').change(function(){
							/*增加异步识别类*/
							var mydate = new Date();
							var randclass = 'ajax'+mydate.getTime()+parseInt(999990*Math.random());
							$(this).parents('label').addClass(randclass);
							/*提交表单*/
							var inpname = $(this).attr('name');
							$("#fileups").attr("action","{:url('System/fileups')}?inpname="+inpname+"&randclass="+randclass);
							$("#fileups").attr("target","upload_target");
							$("#fileups").submit();
						})
						/*删除*/
						$(".del").click(function(){
							var delfileval = $(this).parents('li').find('.fileval');
							$(this).parent().remove();
							fileval(delfileval);
						})
					}
					filechange();
					/*上传添加*/
					$(".fileadd").click(function(){
						var filesinp_num = $('.filesinp').length + 1;
						$(this).parents('.imgbox').before('<div class="imgbox"><label class="files"><input class="filesinp" type="file" name="fileadd_'+filesinp_num+'" value="" /><span><img src="__IMAGE__/ico_white/magnifying_glass.png" /><b>选择文件</b></span></label><span class="del"><img src="__IMAGE__/ico_white/bin.png" /></span></div>');
						filechange();
					})
                    /*状态*/
					function changestatus(){
						var status = $(".switches img").attr('status');
						if(status == 1){
							$(".switches img").attr('src',$(".switches img").attr('imgb'));
                            $(".switches img").parent().find('span').text('启用');
						}else{
							$(".switches img").attr('src',$(".switches img").attr('imga'));
                            $(".switches img").parent().find('span').text('禁用');
						}
					}
					changestatus();
					$(".switches img").click(function(){
						if($(this).attr('status') == 1){
							$(this).attr('status',0);
							$(this).attr('src',$(this).attr('imga'));
							$(this).parent().find('span').text('禁用');
							$("#status").val(0);
						}else{
							$(this).attr('status',1);
							$(this).attr('src',$(this).attr('imgb'));
							$(this).parent().find('span').text('启用');
							$("#status").val(1);						
						}
						changestatus();
					})
					/*提交*/
					
						
                });
				</script>
                <script type="text/javascript" src="__JS__/laydate.js"></script>
                <script>
                $(document).ready(function(e){
                    //日期范围
                    laydate.render({
                      elem: '#daytime'
                      ,format: 'yyyy/MM/dd'
                    });
                    $("#upmit").click(function(){
                        var title = $("input[name='title']").val();
                        if (title == "" || title == null) {
                            alert('名称不能为空');
                            return false;
                        }
                        var minimum = $("input[name='minimum']").val();
                        if (minimum == "" || minimum == null) {
                            alert('最低消费不能为空');
                            return false;
                        }
                        //优惠券有效期 类型选择
                        var favourtype = $("input[name='favourtype']");
                        for(var i=0;i<favourtype.length;i++){ 
                            if(favourtype[i].checked) {
                                var ber = (favourtype[i].value); 
                            }
                        }
                        if (ber == 1) {
                            var day = $("input[name='day']").val();
                            if (day == "" || day == null) {
                                alert('有效天数不能为空');
                                return false;
                            }
                        } else {
                            var daytime = $("input[name='daytime']").val();
                            if (daytime == "" || daytime == null) {
                                alert('有效时间范围不能为空');
                                return false;
                            }
                        }
                        
                        var favourable = $("input[name='favourable']").val();
                        if (favourable == "" || favourable == null) {
                            alert('优惠金额不能为空');
                            return false;
                        }
                        $("#fileups").attr("action","{$submit.url}");
                        $("#fileups").attr("target","");
                        $("#fileups").submit();
                    });
                    // 优惠券有效期 类型选择
                    function hidden() {
                        var favourtype = $("input[name='favourtype']");
                        for(var i=0;i<favourtype.length;i++){ 
                            if(favourtype[i].checked) {
                                var ber = (favourtype[i].value); 
                            } 
                        }
                        if (ber == 1) {
                            $('.daytime').hide();
                            $('.day').show();
                        } else {
                            $('.day').hide();
                            $('.daytime').show();
                        }
                    }
                    hidden();
                    $('#daytype').click(function () {
                        hidden();
                    });
                    //卷类型选择
                    function hiddens() {
                        var type = $("input[name='type']");
                        for(var i=0;i<type.length;i++){ 
                            if(type[i].checked) {
                                var number = (type[i].value); 
                            } 
                        }
                        if (number != 1) {
                            $("input[name='minimum']").val('0');
                            $("input[name='minimum']").attr('readonly','readonly');
                        } else {
                            $("input[name='minimum']");
                            $("input[name='minimum']").removeAttr('readonly');
                        }
                    }
                    hiddens();
                    $('#numbertype').click(function () {
                        hiddens();
                    });

                });
                </script>
              <form>
            </div>
            <!--内容 end-->
        </div>
    </div>
</div>
<!--主体内容 end-->
{include file="$temp_footer" /}